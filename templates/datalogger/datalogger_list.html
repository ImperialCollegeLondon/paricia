{% extends "template_list.html" %}

{% block javascript %}

{{ block.super }}

<script>
var btns = '';
var table;

{% if perms.datalogger.view_datalogger %}
btns = btns + window.btn_detalle_html("{% url 'datalogger:datalogger_detail' 0 %}");
{% endif %}

{% if perms.datalogger.change_datalogger %}
btns = btns + "&nbsp;" + window.btn_editar_html("{% url 'datalogger:datalogger_update' 0 %}");
{% endif %}

{% if perms.datalogger.delete_datalogger %}
btns = btns + "&nbsp;" + window.btn_eliminar_html("{% url 'datalogger:datalogger_delete' 0 %}");
{% endif %}

$(document).ready(function() {

    table = $('#table_datalogger').DataTable({
        language: window.DATATABLES_LANGUAGE,
        scrollX: true,
        "dom": '<"top"f>rt<"bottom"p><"clear">',
        fixedColumns: { leftColumns: 2,},
        columnDefs: [
            { "targets": 0, "visible" : false, "searchable": false },
            { "targets": 1, "defaultOrder": true, "searchable": true,},
            { "targets": 4,
                "render" : function(data, type, row){ if (row[4]==="True") {return "Activo";} else { return "Inactivo";} }
            },
            { "targets": 6, "render" : function(data, type, row){ return btns;}  },
        ],
    });

    // Asociar búsqueda con caja de selección
    table.columns(5).every( function(){
        var column = this;
        var select = $('#filtro_marca').on( 'change', function () {
            var val = $.fn.dataTable.util.escapeRegex(
                $(this).val()
            );

            column
                .search( val ? '^'+val+'$' : '', true, false )
                .draw();
        } );

        column.data().unique().sort().each( function ( d, j ) {
            select.append( '<option value="'+d+'">'+d+'</option>' )
        } );
    } );


    $('#div_loading').hide();
    $('#div_informacion').show();
    table.columns.adjust().draw();
});

</script>
{% endblock %}


{% block titulo %}Datalogger{% endblock %}

{% block cen %}
<label class="sr-only" >Filtrar por marca</label>
<select id="filtro_marca" class="form-control use-placeholder" style="width:auto;">
    <option value="">-------</option>
</select>
{% endblock %}

{% block href_nuevo %}
{% if perms.datalogger.add_datalogger %}{% url 'datalogger:datalogger_create' %}{% endif %}
{% endblock %}

{% block href_exportar %}
{% if perms.datalogger.view_datalogger %}{% url 'datalogger:datalogger_export' %}{% endif %}
{% endblock %}

{% block div_informacion_content %}
    <style>
    tr>:nth-child(1) {min-width:  7em; max-width: 10em;}
    tr>:nth-child(2) {min-width:  7em; max-width: 12em;}
    tr>:nth-child(3) {min-width:  7em; max-width: 12em;}
    tr>:nth-child(4) {min-width:  7em; max-width: 12em;}
    tr>:nth-child(5) {min-width:  7em; max-width: 10em;}

    </style>

    <table id="table_datalogger" class="table table-hover table-sm overflowtooltip" >
        <thead>
        <tr>
            <th>Id</th>
            <th>Código</th>
            <th>Modelo</th>
            <th>Serial</th>
            <th>Estado</th>
            <th>Marca</th>
            <th>Acción</th>
        </tr>
        </thead>

        <tbody>{{ dataloggers|safe }}</tbody>
    </table>
{% endblock %}
