{% load bootstrap4 %}
{% load humanize %}
<script>
// JQuery code to be added in here.
$( function() {

  $(".link_edit").click(function(){
    $.ajax({
      url: $(this).attr('href'),
      type:'GET',
      beforeSend: function () {
        $("#div_loading").show();
        $("#div_informacion").hide();
      },
      success: function (data) {
        $("#div_edit").html(data);
        $("#div_edit").dialog( "open" );
        $("#div_loading").hide();
        $("#div_informacion").show();
      },
      error: function () {
        $("#div_loading").hide();
        $("#div_error").show();
      }
    });
    return false;
  });

  $(".link_delete").click(function(){
    $.ajax({
      url: $(this).attr('href'),
      type:'GET',
      beforeSend: function(){
        activar_espera();
      },
      success: function (data) {
        $("#div_delete").html(data)
        $("#div_delete").dialog("open");
        desactivar_espera();
      },
      error: function () {
        $("#div_loading").hide();
        $("#div_error").show();
      }
    });
    return false;
  });

});

</script>
<div class="col-lg-12">


<div class="row" >
    <div class="col-lg-3 col-md-3 col-sm-6">

        <p class="text-center"><strong>Umbrales</strong></p>
        <div class="row">
            <div class="col-lg-5 col-md-5 col-sm-5">
                <img src="/media/normal.jpg" width="25px"/>
                <small>Normal</small>
            </div>
            <div class="col-lg-7 col-md-7 col-sm-7">
                <img src="/media/error.jpg" width="25px"/>
                <small>Fuera de Rango</small>
            </div>
        </div>
        <p class="font-italic"><small>Desde {{variable.var_minimo}} hasta {{variable.var_maximo}}</small></p>
    </div>
    {% if variable.var_err %}
    <div class="col-lg-6 col-md-6 col-sm-6">
        <p class="text-center"><strong>Resta Consecutiva</strong></p>
        <div class="row">
            <div class="col-lg-4 col-md-2 col-sm-4">
                <img src="/media/normal.jpg" width="25px"/>
                <small>Normal</small>
            </div>
            <div class="col-lg-4 col-md-5 col-sm-4">
                <img src="/media/sospechoso.jpg" width="25px"/>
                <small>Sospechoso</small>
            </div>
            <div class="col-lg-4 col-md-5 col-sm-4">
                <img src="/media/error.jpg" width="25px"/>
                <small>Fuera de Rango</small>
            </div>
        </div>
        <p class="font-italic"><small>Sospechoso (Desde: {{variable.var_sos}} Hasta {{variable.var_err}}) y Erróneo>={{variable.var_err}}</small></p>
    </div>
    {% endif %}
    {% if variable.var_min %}
    <div class="col-lg-3 col-md-3 col-sm-6">
        <p class="text-center"><strong>Variabilidad</strong></p>
        <div class="row">

            <div class="col-lg-5 col-md-5 col-sm-5">
                <img src="/media/normal.jpg" width="25px"/>
                <small>Normal</small>
            </div>
            <div class="col-lg-7 col-md-7 col-sm-7">
                <img src="/media/error.jpg" width="25px"/>
                <small>Fuera de Rango</small>
            </div>

        </div>
        <p class="font-italic"><small>Normal>={{variable.var_min}}</small></p>
    </div>
    {% endif %}
</div>
    </div>
<p>
    <small>*Los Umbrales, Resta Consecutiva y Variabilidad aplican para información con frecuencia de un minuto</small>
</p>



<table class="table table-sm table-fixed">
    <thead class="thead-light">
        <tr>
            <th class="col-2" scope="col">Fecha</th>
            <th class="col-2" scope="col">Hora</th>
            <th class="col-2" scope="col">Valor</th>
            <th class="col-2" scope="col">Resta Consecutiva</th>
            <th class="col-2" scope="col">Variabilidad</th>
            <th class="col-2" scope="col">Acciones</th>
        </tr>
    </thead>

    <tbody>
        {% for item in lista %}
        <tr>
            <td scope="row" class="col-2">{{ item.fecha|date:"d/m/Y"}}</td>
            <td class="col-2">{{ item.hora|date:"H:i:s"}}</td>
            {% if item.valor_error %}
            <td class="col-2" style="background-color: #ff1a1a;">{{ item.valor|floatformat:3}}</td>
            {% else %}
            <td class="col-2" style="background-color: #90EE90;">{{ item.valor|floatformat:3}}</td>
            {%endif%}
            {% ifequal item.resta_error "normal" %}
            <td class="col-2" style="background-color: #90EE90;">{{ item.resta|floatformat:3}}</td>
            {% else %}
            {% ifequal item.resta_error "sospechoso" %}
            <td class="col-2" style="background-color: #ff4500;">{{ item.resta|floatformat:3}}</td>
            {% else %}
            {% ifequal item.resta_error "error" %}
            <td class="col-2" style="background-color: #ff1a1a;">{{ item.resta|floatformat:3}}</td>
            {% else %}
            <td class="col-2">&nbsp;</td>
            {% endifequal %}
            {% endifequal %}
            {% endifequal %}
            {% if item.variabilidad %}
            {% ifequal item.var_error True %}
            <td class="col-2" style="background-color: #ff1a1a;">{{ item.variabilidad|floatformat:3}}</td>
            {% else %}
            {% ifequal item.var_error False %}
            <td class="col-2" style="background-color: #90EE90;">{{ item.variabilidad|floatformat:3}}</td>
            {% else %}
            <td class="col-2">&nbsp;</td>
            {% endifequal %}
            {% endifequal %}
            {% else %}
            <td class="col-2">&nbsp;</td>
            {% endif %}


            <td class="col-2">
                <a class="link_edit" href="{% url 'medicion:medicion_update' item.med_id item.fecha item.var_id %}">
                    <span class="far fa-edit" aria-hidden="true"></span>
                </a>
                <a class="link_delete" href="{% url 'medicion:medicion_delete' item.med_id item.fecha item.var_id %}">
                    <span class="far fa-trash-alt" aria-hidden="true"></span>
                </a>
            </td>
        </tr>

        {% endfor%}

    </tbody>

</table>
